<!DOCTYPE html>
<!--[if lt IE 7 ]><html class="ie ie6" lang="en"> <![endif]-->
<!--[if IE 7 ]><html class="ie ie7" lang="en"> <![endif]-->
<!--[if IE 8 ]><html class="ie ie8" lang="en"> <![endif]-->
<!--[if (gte IE 9)|!(IE)]><!--><html lang="en"> <!--<![endif]-->
<head>

	<!-- Basic Page Needs
  ================================================== -->
	<meta charset="utf-8">
	<title>soundcloud api hacking</title>
	<meta name="description" content="">
	<meta name="author" content="">
	<!--[if lt IE 9]>
		<script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
	<![endif]-->

	<!-- Mobile Specific Metas
  ================================================== -->
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

	<!-- CSS
  ================================================== -->
  <link rel="stylesheet" href="css/base.css">
  <link rel="stylesheet" href="css/skeleton.css">
  <link rel="stylesheet" href="css/layout.css">

	<!-- Favicons
	================================================== -->
	<link rel="shortcut icon" href="images/favicon.ico">
	<link rel="apple-touch-icon" href="images/apple-touch-icon.png">
	<link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
	<link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">

</head>
<body>



	<!-- Primary Page Layout
	================================================== -->


	<div class="container">

		<div id="header">
		  <span>fave-o-matic</span>
		</div>
		<div id="connect-form">
		  <script src="http://connect.soundcloud.com/2/latest.min.js"></script>

      <script type="text/javascript" charset="utf-8">
        // SC.connectForm({
        //   size:         "l",                 // size of the button (s, m, l)
        //   client_id:    "956307a721999662072e3d9978287449",
        //   redirect_uri: "http://ascott.github.com/soundcloud-favs/soundcloud-callback.html",
        //   flow:         "code",
        //   connected: function(){
        //     SC.get("/me", function(me){
        //       getUserFollowings(me.id)
        //     });
        //     $('#cwsw-connect').css('display','none');
        //     $('#cwsw-disconnect').css('display','block');
        // 
        //   },
        //   disconnected: function(){
        //     $('#cwsw-disconnect').css('display','none');
        //     $("#mix").remove();
        //     $('#cwsw-connect').css('display','block');
        //     
        // 
        //   }
        // });
      </script>
		</div>
		
		<ul id="mix"></ul>
		
		


	</div><!-- container -->



	<!-- JS
	================================================== -->
	<script src="http://code.jquery.com/jquery-1.6.4.min.js"></script>
  <script type="text/javascript" src="js/soundcloud.player.api.js"></script>
  <script type="text/javascript" src="js/sc-player.js"></script>
 

	
	
	<script type="text/javascript" charset="utf-8">
	

    $(document).ready(function() {
      
      $(document).bind('onPlayerInit.scPlayer', function(event){
        console.log(event.target, 'is ready!');
      });
      $(document).bind('onPlayerPlay.scPlayer', function(event){
        console.log(event.target, 'its playing!');
      });
      $(document).bind('onMediaTimeUpdate.scPlayer', function(event){
        console.log(event.target, 'the track is at ' + event.position + ' out of ' + event.duration + ' which is ' + event.relative + ' of the total');
      });
      
      $.scPlayer.defaults.onDomReady = null;
	    
      getUserFollowings('7787606'); //7787606 //3207
      
      $('#cwsw-disconnect').click(function(){
  	    SC.disconnect();
  	  });
    });
    
    function getRandomInt(min, max) {
      return Math.floor(Math.random() * (max - min + 1)) + min;
    }
    
    
    function getUserFollowings(curUserId){
      $.ajax({
        url: 'https://api.soundcloud.com/users/'+curUserId+'/followings.json?client_id=956307a721999662072e3d9978287449',
        type: 'GET',
        dataType: 'json',
        complete: function(xhr, textStatus) {
          //console.log('complete', xhr, textStatus);
        },
        success: function(data, textStatus, xhr) {
          var mixlen = 10;
          var i = 0;
          while(i < mixlen){
            var rand = getRandomInt(0, data.length-1);
            //does this user have public favs?
            if (data[rand].public_favorites_count != 0){
              getFollowersFavs(data[rand].id);
              i++;             
            }
            else{
              console.log('no favs :(');
            }
          }
          if (i == mixlen){
            console.log("i= "+i);
            $('.track').scPlayer();
          }
          
        },
        error: function(xhr, textStatus, errorThrown) {
          console.log('error', xhr, textStatus, errorThrown);
        }
      });

    }
    
    function getFollowersFavs(followerid){     
      $.ajax({
        url: 'https://api.soundcloud.com/users/'+followerid+'/favorites.json?client_id=956307a721999662072e3d9978287449',
        type: 'GET',
        dataType: 'json',
        complete: function(xhr, textStatus) {
          //console.log('complete', xhr, textStatus);
        },
        success: function(data, textStatus, xhr) {
          //console.log('success', data, textStatus, xhr);
          if(data.length > 0) {
            getFavTrack(data);
          }
        },
        error: function(xhr, textStatus, errorThrown) {
          console.log('error', xhr, textStatus, errorThrown);
        }
      });
      //var rand = Math.floor(Math.random()*len);      
      //console.log(data[rand].followings_count);
    }
    
    function getFavTrack(data){
      var rand = getRandomInt(0, data.length-1);
      var s = '<li id="sc-'+rand+'"><a href="'+data[rand].permalink_url+'" id="sc-player-'+rand+'" class="track">'+data[rand].title+' by '+data[rand].user.username+'</a></li>'
      
      //var s = '<iframe width="100%" height="166" scrolling="no" src="http://w.soundcloud.com/player/?url='+data[rand].uri+'&auto_play=false&show_artwork=true" frameborder="0" ></iframe>'
      $("#mix").append(s);
      
      $('#sc-'+rand).scPlayer();  
    }    
    
	</script>
	


<!-- End Document
================================================== -->
</body>
</html>